var D={"Content-Type":"application/json"},U=/\{[^{}]+\}/g;function H(s){let{baseUrl:t="",fetch:e=globalThis.fetch,querySerializer:n,bodySerializer:r,headers:i,...a}={...s};t.endsWith("/")&&(t=t.substring(0,t.length-1)),i=T(D,i);let l=[];async function u(c,o){let{fetch:p=e,headers:q,params:R={},parseAs:j="json",querySerializer:b,bodySerializer:A=r??I,...C}=o||{},x=typeof n=="function"?n:E(n);b&&(x=typeof b=="function"?b:E({...typeof n=="object"?n:{},...b}));let h={redirect:"follow",...a,...C,headers:T(i,q,R.header)};h.body&&(h.body=A(h.body)),h.body instanceof FormData&&h.headers.delete("Content-Type");let m=new Request(L(c,{baseUrl:t,params:R,querySerializer:x}),h),S={baseUrl:t,fetch:p,parseAs:j,querySerializer:x,bodySerializer:A};for(let d of l)if(d&&typeof d=="object"&&typeof d.onRequest=="function"){m.schemaPath=c,m.params=R;let y=await d.onRequest(m,S);if(y){if(!(y instanceof Request))throw new Error("Middleware must return new Request() when modifying the request");m=y}}let f=await p(m);for(let d=l.length-1;d>=0;d--){let y=l[d];if(y&&typeof y=="object"&&typeof y.onResponse=="function"){let g=await y.onResponse(f,S);if(g){if(!(g instanceof Response))throw new Error("Middleware must return new Response() when modifying the response");f=g}}}if(f.status===204||f.headers.get("Content-Length")==="0")return f.ok?{data:{},response:f}:{error:{},response:f};if(f.ok)return j==="stream"?{data:f.body,response:f}:{data:await f[j](),response:f};let $=await f.text();try{$=JSON.parse($)}catch{}return{error:$,response:f}}return{async GET(c,o){return u(c,{...o,method:"GET"})},async PUT(c,o){return u(c,{...o,method:"PUT"})},async POST(c,o){return u(c,{...o,method:"POST"})},async DELETE(c,o){return u(c,{...o,method:"DELETE"})},async OPTIONS(c,o){return u(c,{...o,method:"OPTIONS"})},async HEAD(c,o){return u(c,{...o,method:"HEAD"})},async PATCH(c,o){return u(c,{...o,method:"PATCH"})},async TRACE(c,o){return u(c,{...o,method:"TRACE"})},use(...c){for(let o of c)if(o){if(typeof o!="object"||!("onRequest"in o||"onResponse"in o))throw new Error("Middleware must be an object with one of `onRequest()` or `onResponse()`");l.push(o)}},eject(...c){for(let o of c){let p=l.indexOf(o);p!==-1&&l.splice(p,1)}}}}function w(s,t,e){if(t==null)return"";if(typeof t=="object")throw new Error("Deeply-nested arrays/objects aren\u2019t supported. Provide your own `querySerializer()` to handle these.");return`${s}=${e?.allowReserved===!0?t:encodeURIComponent(t)}`}function z(s,t,e){if(!t||typeof t!="object")return"";let n=[],r={simple:",",label:".",matrix:";"}[e.style]||"&";if(e.style!=="deepObject"&&e.explode===!1){for(let l in t)n.push(l,e.allowReserved===!0?t[l]:encodeURIComponent(t[l]));let a=n.join(",");switch(e.style){case"form":return`${s}=${a}`;case"label":return`.${a}`;case"matrix":return`;${s}=${a}`;default:return a}}for(let a in t){let l=e.style==="deepObject"?`${s}[${a}]`:a;n.push(w(l,t[a],e))}let i=n.join(r);return e.style==="label"||e.style==="matrix"?`${r}${i}`:i}function O(s,t,e){if(!Array.isArray(t))return"";if(e.explode===!1){let i={form:",",spaceDelimited:"%20",pipeDelimited:"|"}[e.style]||",",a=(e.allowReserved===!0?t:t.map(l=>encodeURIComponent(l))).join(i);switch(e.style){case"simple":return a;case"label":return`.${a}`;case"matrix":return`;${s}=${a}`;case"spaceDelimited":case"pipeDelimited":default:return`${s}=${a}`}}let n={simple:",",label:".",matrix:";"}[e.style]||"&",r=[];for(let i of t)e.style==="simple"||e.style==="label"?r.push(e.allowReserved===!0?i:encodeURIComponent(i)):r.push(w(s,i,e));return e.style==="label"||e.style==="matrix"?`${n}${r.join(n)}`:r.join(n)}function E(s){return function(e){let n=[];if(e&&typeof e=="object")for(let r in e){let i=e[r];if(i!=null){if(Array.isArray(i)){n.push(O(r,i,{style:"form",explode:!0,...s?.array,allowReserved:s?.allowReserved||!1}));continue}if(typeof i=="object"){n.push(z(r,i,{style:"deepObject",explode:!0,...s?.object,allowReserved:s?.allowReserved||!1}));continue}n.push(w(r,i,s))}}return n.join("&")}}function P(s,t){let e=s;for(let n of s.match(U)??[]){let r=n.substring(1,n.length-1),i=!1,a="simple";if(r.endsWith("*")&&(i=!0,r=r.substring(0,r.length-1)),r.startsWith(".")?(a="label",r=r.substring(1)):r.startsWith(";")&&(a="matrix",r=r.substring(1)),!t||t[r]===void 0||t[r]===null)continue;let l=t[r];if(Array.isArray(l)){e=e.replace(n,O(r,l,{style:a,explode:i}));continue}if(typeof l=="object"){e=e.replace(n,z(r,l,{style:a,explode:i}));continue}if(a==="matrix"){e=e.replace(n,`;${w(r,l)}`);continue}e=e.replace(n,a==="label"?`.${l}`:l)}return e}function I(s){return JSON.stringify(s)}function L(s,t){let e=`${t.baseUrl}${s}`;t.params?.path&&(e=P(e,t.params.path));let n=t.querySerializer(t.params.query??{});return n.startsWith("?")&&(n=n.substring(1)),n&&(e+=`?${n}`),e}function T(...s){let t=new Headers;for(let e of s){if(!e||typeof e!="object")continue;let n=e instanceof Headers?e.entries():Object.entries(e);for(let[r,i]of n)if(i===null)t.delete(r);else if(Array.isArray(i))for(let a of i)t.append(r,a);else i!==void 0&&t.set(r,i)}return t}export{L as createFinalURL,E as createQuerySerializer,H as default,I as defaultBodySerializer,P as defaultPathSerializer,T as mergeHeaders,O as serializeArrayParam,z as serializeObjectParam,w as serializePrimitiveParam};
